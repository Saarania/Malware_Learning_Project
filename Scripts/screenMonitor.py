import pyautogui
from datetime import datetime
import os

# folder name where we will store screenshots etc.
import fileManager
from localization import Localization

IMAGE_FOLDER_NAME: str = "screenshots"

last_image_size = 0


def size_save_check(img_name: str):
    """
    If new printcreen is same size as previous one, it means we talk about exactly same photos. This method will
    interrupt this duplicity for the sake of saving space.
    """
    global last_image_size
    img_path = Localization.get_path(Localization.APPDATA) + IMAGE_FOLDER_NAME + "\\" + img_name
    image_size = os.path.getsize(img_path)

    if abs(image_size - last_image_size) <= 2000:
        os.remove(img_path)
    last_image_size = image_size


def save_screenshot():
    """
    Method immediately captures screen shot and saves it to the prepared folder in appdata
    (for more info, look to the FileManager class).
    File will be named as the current date and time.

    :return image of current screen
    """
    screenshot = pyautogui.screenshot()

    file_name = str(datetime.now()) + ".png"
    file_name = file_name.replace(":", "_").replace("-", " ")  # we cant have ":" in file name
    # Create image folder dir in appdata if does not exist
    img_path = Localization.get_path(Localization.APPDATA) + IMAGE_FOLDER_NAME
    fileManager.make_road(img_path)
    # Save image to file
    image_absolute_path = str(img_path + "\\" + file_name)

    screenshot.save(image_absolute_path)
    size_save_check(file_name)


# sc = ScreenMonitor()
# sc.take_screenshot()


