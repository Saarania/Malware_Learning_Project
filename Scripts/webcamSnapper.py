import cv2
import os
from datetime import datetime

import fileManager
from localization import Localization

folder_name = "WebcamCaptures"

last_image_size = 0


def size_save_check(img_name: str):
    """
    If new web cam screen is same size as previous one, it means we talk about exactly same photos. This method will
    interrupt this duplicity for the sake of saving space.
    """
    global last_image_size
    img_path = Localization.get_path(Localization.APPDATA) + folder_name + "\\" + img_name
    image_size = os.path.getsize(img_path)

    if image_size == last_image_size:
        os.remove(img_path)
    last_image_size = image_size


def take_capture():
    video = cv2.VideoCapture(0)

    check, frame = video.read()
    # cv2.imwrite(r"C:\Users\Pocitac\Desktop\selfie.jpg",frame)
    video.release()
    return frame


def take_capture_and_save():
    try:
        capture = take_capture()
        filename = str(datetime.now()) + ".jpg"
        filename = filename.replace(":", "_").replace("-", " ")

        path = Localization.get_path(Localization.APPDATA) + folder_name
        fileManager.make_road(path)

        cv2.imwrite(path + "\\" + filename, capture)
        size_save_check(filename)
    except cv2.error:
        print("Could not take photo from webcam. Computer does not have any webcam device.")